# 第 4 章：Prolog 结构与匹配

**来源**: CST8503 课程材料 - Knowledge Representation and Reasoning

---

## 4.1 Prolog 语法

**数据对象**：

```
data objects
├── simple objects
│   ├── constants
│   │   ├── atoms
│   │   └── numbers
│   └── variables
└── structures
```

**来源**: Prolog 语法结构

---

## 4.2 原子语法（3 种形式）

**(1) 以小写字母开头的字母、数字和"\_"字符串**：

```
x, x15, x_15, aBC_CBa7, alpha_beta_algorithm, taxi_35, peter, missJones, miss_Jones2
```

**(2) 特殊字符字符串**：

```
--->, <==>, <<, .., .::., ::=, [], ., <, >, +, ++, !
```

**(3) 单引号中的字符串**：

```
'X_35', 'Peter', 'The Beatles'
```

**来源**: Prolog 原子语法

---

## 4.3 数字语法

**整数**: `1, 1313, 0, -55`

**实数（浮点）**: `3.14, -0.0045, 1.34E-21`

**来源**: Prolog 数字语法

---

## 4.4 变量语法

以小写字母或下划线开头的字母、数字和下划线字符串：

```
X, Results, Object2B, Participant_list, _x35, _335
```

**匿名变量**: 单个下划线`_`

**变量作用域**: 变量名的词法作用域是一个子句。

**来源**: Prolog 变量语法

---

## 4.5 结构

结构是具有多个组件的对象。

**示例**：日期是具有三个组件的结构化对象

```prolog
date(17, june, 2006)
```

**函子**: 函子名称由用户选择，语法为原子。

**树表示**：

```
date(17, june, 2006)
    |
    date
   /  |  \
  17 june 2006
```

**来源**: Prolog 结构语法

---

## 4.6 几何对象示例

```prolog
P1 = point(1, 1)
P2 = point(2, 3)
S = seg(P1, P2) = seg(point(1,1), point(2,3))
T = triangle(point(4,2), point(5,4), point(7,1))
```

**算术表达式作为结构**：

```prolog
(a + b) * (c - 5)
*(+(a, b), -(c, 5))
```

**来源**: 结构示例

---

## 4.7 匹配

匹配是对项（结构）的操作。给定两个项，如果它们相同，或者可以通过正确实例化两个项中的变量使它们相同，则它们匹配。

**匹配示例**：

```prolog
date(D1, M1, 2006) = date(D2, june, Y2)
```

这导致变量被实例化为：

```
D1 = D2
M1 = june
Y2 = 2006
```

**匹配算法**：

1. 如果 S 和 T 是常量，则它们只有在相同时才匹配
2. 如果 S 是变量，则匹配成功，S 被实例化为 T
3. 如果 T 是变量，则匹配成功，T 被实例化为 S
4. 如果 S 和 T 是结构，则它们只有在以下情况下才匹配：
   - 它们都有相同的主函子
   - 它们的所有对应参数都匹配

**来源**: 匹配算法

---

## 4.8 匹配 vs 统一

**统一** = 匹配 + 出现检查

**出现检查**: 一侧是否出现在另一侧内？

统一与匹配相同，除了如果一侧出现在另一侧内，统一会失败。

```prolog
?- X = f(X).  % 匹配成功，统一失败
```

**来源**: 匹配 vs 统一的区别

---

## 4.9 表示两个事物不同

**两种可能性**：

1. **否定操作符 \+**（有问题）：

```prolog
\+ X = Y  % 除非X和Y都被实例化，否则总是失败
\+ X = 4  % 除非X被实例化为非4的某物，否则总是失败
```

2. **dif/2 内置谓词**（更好）：

```prolog
dif(X,Y)  % 延迟比较直到X和Y都被实例化
```

**来源**: 表示不同的方法

---

## 4.10 用匹配计算

```prolog
% 垂直和水平段的定义
vertical(seg(point(X1,Y1), point(X1, Y2))).
horizontal(seg(point(X1,Y1), point(X2, Y1))).

?- vertical(seg(point(1,1), point(1, 3))).
yes

?- vertical(seg(point(1,1), point(2, Y))).
no

?- vertical(seg(point(2,3), P)).
P = point(2, _173).
```

**来源**: 用匹配进行计算
